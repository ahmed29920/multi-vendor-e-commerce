# ุขููุฉ ุชุบููุฑ ุงูุจุงูุงุช (Plan Switching)

## ุงูุณููู ุงูุงูุชุฑุงุถู ๐ฏ

**ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ:**
- โ **ุงูุชุฑููุฉ (Upgrade)**: ุงูุชุบููุฑ ููุฑุงู - ุชุญุตู ุนูู ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ ูุจุงุดุฑุฉ
- โณ **ุงูุชุฎููุถ (Downgrade)**: ุงูุงูุชุธุงุฑ ุญุชู ุงูุชูุงุก ุงูุงุดุชุฑุงู ุงูุญุงูู - ุชุณุชููุฏ ูู ุงููููุฒุงุช ุญุชู ุงูููุงูุฉ

## ุงูุณููุงุฑูููุงุช ุงููุฎุชููุฉ

### 1. ุงูุชุฌุฏูุฏ (Renewal) - ููุณ ุงูุจุงูุฉ โ
**ูุงุฐุง ูุญุฏุซ:**
- ุฅุฐุง ูุงู vendor ูุดุชุฑู ูู ุจุงูุฉ ูุนููุฉ ููุฑูุฏ ุงูุชุฌุฏูุฏ ูู ููุณ ุงูุจุงูุฉ
- ูุชู ุฅุถุงูุฉ ูุฏุฉ ุงูุจุงูุฉ ุฅูู ุชุงุฑูุฎ ุงูููุงูุฉ ุงูุญุงูู
- ุงูุงุดุชุฑุงู ูุจูู ูุดุทุงู

**ูุซุงู:**
```
ุงูุงุดุชุฑุงู ุงูุญุงูู: ูู 2026-01-01 ุฅูู 2026-02-01 (30 ููู)
ุงูุชุฌุฏูุฏ: +30 ููู
ุงููุชูุฌุฉ: ูู 2026-01-01 ุฅูู 2026-03-01
```

---

### 2. ุงูุชุฑููุฉ (Upgrade) - ุจุงูุฉ ุฃูุถู โ
**ุงูุณููู ุงูุงูุชุฑุงุถู: ุงูุชุบููุฑ ููุฑุงู (immediate = true)**

**ูุงุฐุง ูุญุฏุซ:**
- ูุชู ุฅูุบุงุก ุงูุงุดุชุฑุงู ุงููุฏูู ููุฑุงู (`status = 'inactive'`)
- ูุชู ุฅูุดุงุก ุงุดุชุฑุงู ุฌุฏูุฏ ูุจุฏุฃ ูู ุงูุขู
- vendor ูุญุตู ุนูู ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ ููุฑุงู
- ูุง ุชูุฌุฏ ูููุฏ (ูุฃู ุงูุจุงูุฉ ุงูุฌุฏูุฏุฉ ุฃูุถู)

**ุงูุณุจุจ:** ุงููุณุชุฎุฏู ูุฏูุน ุฃูุซุฑ ููุฌุจ ุฃู ูุญุตู ุนูู ุงููููุฒุงุช ููุฑุงู

**ูุซุงู:**
```
ุงูุจุงูุฉ ุงููุฏููุฉ: Basic (10 ููุชุฌุงุชุ ุจุฏูู featuring)
ุงูุจุงูุฉ ุงูุฌุฏูุฏุฉ: Premium (100 ููุชุฌุ ูุน featuring)
ุงููุชูุฌุฉ: ูุญุตู ุนูู Premium ููุฑุงู
```

---

### 3. ุงูุชุฎููุถ (Downgrade) - ุจุงูุฉ ุฃูู โ
**ุงูุณููู ุงูุงูุชุฑุงุถู: ุงูุงูุชุธุงุฑ ุญุชู ุงูุชูุงุก ุงูุงุดุชุฑุงู ุงูุญุงูู (immediate = false)**

**ูุงุฐุง ูุญุฏุซ (ุงูุณููู ุงูุงูุชุฑุงุถู - ุงูุงูุชุธุงุฑ):**
- ูุชู ุฅูุดุงุก ุงุดุชุฑุงู ุฌุฏูุฏ ุจุญุงูุฉ `inactive`
- ุชุงุฑูุฎ ุงูุจุฏุงูุฉ = ุงูููู ุงูุชุงูู ูุงูุชูุงุก ุงูุงุดุชุฑุงู ุงูุญุงูู
- ุงูุงุดุชุฑุงู ุงูุญุงูู ูุจูู ูุดุทุงู ุญุชู ููุชูู
- vendor ูุณุชูุฑ ูู ุงูุงุณุชูุงุฏุฉ ูู ุงููููุฒุงุช ุงูุญุงููุฉ ุญุชู ุงูููุงูุฉ
- ุนูุฏ ุจุฏุก ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏ (ุชููุงุฆูุงู ุนุจุฑ cron):
  - ูุชู ุฅูุบุงุก ุชูุนูู ุงูุงุดุชุฑุงู ุงููุฏูู
  - ูุชู ุชุทุจูู ุงููููุฏ ุชููุงุฆูุงู:
    - ุฅุฒุงูุฉ ุงูุชููุฒ ูู ุงูููุชุฌุงุช ุงููููุฒุฉ
    - ุฅูุบุงุก ุชูุนูู ุงูููุชุฌุงุช ุงูุฒุงุฆุฏุฉ

**ูุงุฐุง ูุญุฏุซ (ุฅุฐุง ุงุฎุชุงุฑ ุงูุชุบููุฑ ุงูููุฑู - immediate = true):**
- ูุชู ุงูุชุญูู ูู ุงููููุฏ ูุจู ุงูุชุบููุฑ:
  - ุฅุฐุง ูุงู ูุฏูู ููุชุฌุงุช ูููุฒุฉ ูุงูุจุงูุฉ ุงูุฌุฏูุฏุฉ ูุง ุชุฏุนููุง โ ุฎุทุฃ
  - ุฅุฐุง ูุงู ูุฏูู ููุชุฌุงุช ุฃูุซุฑ ูู ุงููุณููุญ โ ุฎุทุฃ
- ุฅุฐุง ูุฌุญ ุงูุชุญูู:
  - ูุชู ุฅูุบุงุก ุงูุงุดุชุฑุงู ุงููุฏูู ููุฑุงู
  - ูุชู ุฅุฒุงูุฉ ุงููููุฒุงุช ุบูุฑ ุงููุฏุนููุฉ:
    - ุฅุฒุงูุฉ ุงูุชููุฒ ูู ุงูููุชุฌุงุช ุงููููุฒุฉ
    - ุฅูุบุงุก ุชูุนูู ุงูููุชุฌุงุช ุงูุฒุงุฆุฏุฉ (ุงูุฃุญุฏุซ ุฃููุงู)
  - ูุชู ุฅูุดุงุก ุงุดุชุฑุงู ุฌุฏูุฏ ูุจุฏุฃ ูู ุงูุขู

**ุงูุณุจุจ:** ุงููุณุชุฎุฏู ุฏูุน ููุงุดุชุฑุงู ุงูุญุงูู ููุฌุจ ุฃู ูุณุชููุฏ ููู ุญุชู ุงูููุงูุฉ

**ูุซุงู:**
```
ุงูุจุงูุฉ ุงููุฏููุฉ: Premium (100 ููุชุฌุ ูุน featuring)
ุงูุจุงูุฉ ุงูุฌุฏูุฏุฉ: Basic (10 ููุชุฌุงุชุ ุจุฏูู featuring)
ุงููุถุน ุงูุญุงูู: 15 ููุชุฌ ูุดุทุ 3 ููุชุฌุงุช ูููุฒุฉ

ุงููุชูุฌุฉ:
- ุฎุทุฃ: ูุฌุจ ุฅุฒุงูุฉ ุงูุชููุฒ ูู 3 ููุชุฌุงุช ุฃููุงู
- ุฎุทุฃ: ูุฌุจ ุฅูุบุงุก ุชูุนูู 5 ููุชุฌุงุช ุนูู ุงูุฃูู
```

---

## ุงูุชุญุณููุงุช ุงููุถุงูุฉ

### 1. ุฏุงูุฉ `isDowngrade()` 
ุชุญุฏุฏ ุชููุงุฆูุงู ุฅุฐุง ูุงู ุงูุชุบููุฑ ุชุฑููุฉ ุฃู ุชุฎููุถ ุจูุงุกู ุนูู:
- ุงูุณุนุฑ
- ุฅููุงููุฉ ุงูุชููุฒ (featuring)
- ุงูุญุฏ ุงูุฃูุตู ูุนุฏุฏ ุงูููุชุฌุงุช

### 2. ุงูุชุญูู ุงููุณุจู ูู ุงููููุฏ
ูุจู ุงูุชุฎููุถุ ูุชู ุงูุชุญูู ูู:
- ุนุฏุฏ ุงูููุชุฌุงุช ุงููููุฒุฉ
- ุนุฏุฏ ุงูููุชุฌุงุช ุงููุดุทุฉ
- ุฅุนุทุงุก ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

### 3. ูุนุงูุฌุฉ ููุฑูุฉ ูููููุฏ
ุนูุฏ ุงูุชุฎููุถ ุงูููุฑู:
- ุฅุฒุงูุฉ ุงูุชููุฒ ูู ุงูููุชุฌุงุช ุชููุงุฆูุงู
- ุฅูุบุงุก ุชูุนูู ุงูููุชุฌุงุช ุงูุฒุงุฆุฏุฉ (ุงูุฃุญุฏุซ ุฃููุงู)

### 4. ุชูุนูู ุงูุงุดุชุฑุงูุงุช ุงููุฌุฏููุฉ ุชููุงุฆูุงู โ
**Command:** `php artisan subscriptions:activate-scheduled`

**ูุงุฐุง ููุนู:**
- ูุชุญูู ููููุงู ูู ุงูุงุดุชุฑุงูุงุช ุงููุฌุฏููุฉ (`status = 'inactive'`)
- ุฅุฐุง ูุตู ุชุงุฑูุฎ ุงูุจุฏุงูุฉ โ ููุนููุง ุชููุงุฆูุงู
- ูุทุจู ุงููููุฏ ุนูุฏ ุงูุชูุนูู (ููุชุฎููุถ)
- ูุญุฏุซ ูุนูููุงุช ุงูุจุงูุฉ ูู ุฌุฏูู `vendors`

**ุฅุนุฏุงุฏ Cron:**
```bash
# ูู routes/console.php ุฃู crontab
Schedule::command('subscriptions:activate-scheduled')
    ->daily()
    ->at('00:01'); // ุจุนุฏ ุฏูููุฉ ูู ููุชุตู ุงูููู
```

---

## ุงูููุฏ ุงูุญุงูู

### ุนูุฏ ุงูุชุฌุฏูุฏ (ููุณ ุงูุจุงูุฉ):
```php
if ($current && $current->plan_id === $plan->id) {
    // ุฅุถุงูุฉ ุงููุฏุฉ ุฅูู ุชุงุฑูุฎ ุงูููุงูุฉ
    $current->end_date = $current->end_date->addDays($plan->duration_days);
    $current->status = 'active';
    $current->save();
}
```

### ุนูุฏ ุงูุชุบููุฑ (ุจุงูุฉ ูุฎุชููุฉ):
```php
// 1. ุชุญุฏูุฏ ููุน ุงูุชุบููุฑ (ุชุฑููุฉ ุฃู ุชุฎููุถ)
$isDowngrade = $this->isDowngrade($currentPlan, $plan);

// 2. ุชุญุฏูุฏ ุงูุณููู ุงูุงูุชุฑุงุถู
// ุงูุชุฑููุฉ = ููุฑูุ ุงูุชุฎููุถ = ุงูุงูุชุธุงุฑ
if (!isset($data['immediate'])) {
    $immediate = !$isDowngrade;
}

// 3. ุฅุฐุง ูุงู ุชุฎููุถ ููุฑู: ุงูุชุญูู ูู ุงููููุฏ
if ($isDowngrade && $immediate) {
    // ุงูุชุญูู ูู ุงูููุชุฌุงุช ุงููููุฒุฉ
    // ุงูุชุญูู ูู ุนุฏุฏ ุงูููุชุฌุงุช
}

// 4. ุฅุฐุง ูุงู ููุฑู: ุฅูุบุงุก ุงูุงุดุชุฑุงู ุงููุฏูู ูุชุทุจูู ุงููููุฏ
if ($immediate) {
    $current->status = 'inactive';
    // ุชุทุจูู ุงููููุฏ ููุฑุงู
} else {
    // ุงูุงูุชุธุงุฑ: ุฅูุดุงุก ุงุดุชุฑุงู ูุฌุฏูู
    // ุชุงุฑูุฎ ุงูุจุฏุงูุฉ = ุจุนุฏ ุงูุชูุงุก ุงูุงุดุชุฑุงู ุงูุญุงูู
}

// 5. ุฅูุดุงุก ุงุดุชุฑุงู ุฌุฏูุฏ
$vendor->subscriptions()->create([
    'status' => $immediate ? 'active' : 'inactive'
]);
```

---

## ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุฑููุฉ ููุฑูุฉ
```
ุงููุถุน: Basic โ Premium
ุงููุชูุฌุฉ: โ ูุญุตู ุนูู Premium ููุฑุงู
```

### ูุซุงู 2: ุชุฎููุถ ูุน ูููุฏ
```
ุงููุถุน: Premium โ Basic
ูุฏูู: 15 ููุชุฌ ูุดุทุ 3 ูููุฒ
ุงููุชูุฌุฉ: โ ุฎุทุฃ - ูุฌุจ ุฅุฒุงูุฉ ุงููููุฏ ุฃููุงู
```

### ูุซุงู 3: ุชุฎููุถ ุจุนุฏ ุฅุฒุงูุฉ ุงููููุฏ
```
ุงููุถุน: Premium โ Basic
ูุฏูู: 8 ููุชุฌ ูุดุทุ 0 ูููุฒ
ุงููุชูุฌุฉ: โ ูุชู ุงูุชุฎููุถ + ุฅูุบุงุก ุชูุนูู 0 ููุชุฌ
```

---

## ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุญูู ุงููุณุจู**: ุนูุฏ ุงูุชุฎููุถุ ูุชู ุงูุชุญูู ูู ุงููููุฏ ูุจู ุงูุชุบููุฑ
2. **ุงููุนุงูุฌุฉ ุงูุชููุงุฆูุฉ**: ุนูุฏ ุงูุชุฎููุถ ุงูููุฑูุ ูุชู ุชุทุจูู ุงููููุฏ ุชููุงุฆูุงู
3. **ุงูููุชุฌุงุช ุงูุฒุงุฆุฏุฉ**: ูุชู ุฅูุบุงุก ุชูุนูู ุงูุฃุญุฏุซ ุฃููุงู
4. **ุงูุฑุณุงุฆู ุงููุงุถุญุฉ**: ุฑุณุงุฆู ุฎุทุฃ ุชูุถุญ ุจุงูุถุจุท ูุง ูุฌุจ ูุนูู

---

## Commands ุงููุทููุจุฉ ูู Cron

### 1. ุชูุนูู ุงูุงุดุชุฑุงูุงุช ุงููุฌุฏููุฉ
```bash
php artisan subscriptions:activate-scheduled
```
**ุงูุชูุฑุงุฑ:** ููููุงู ูู 00:01

### 2. ุงูุชูุงุก ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ
```bash
php artisan subscriptions:expire
```
**ุงูุชูุฑุงุฑ:** ููููุงู ูู 00:00

### ุฅุนุฏุงุฏ Laravel Scheduler
ูู `routes/console.php`:
```php
Schedule::command('subscriptions:expire')
    ->daily()
    ->at('00:00');

Schedule::command('subscriptions:activate-scheduled')
    ->daily()
    ->at('00:01');
```

## ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

1. **Pro-rated Billing**: ุญุณุงุจ ุงูููุช ุงููุชุจูู ูู ุงูุงุดุชุฑุงู ุงููุฏูู
2. **Credit System**: ุฅุถุงูุฉ ุฑุตูุฏ ููููุช ุงููุชุจูู
3. **Upgrade Promotions**: ุนุฑูุถ ุฎุงุตุฉ ุนูุฏ ุงูุชุฑููุฉ
4. **Downgrade Grace Period**: ูุชุฑุฉ ุณูุงุญ ูุจู ุชุทุจูู ุงููููุฏ
5. **Email Notifications**: ุฅุดุนุงุฑุงุช ุนูุฏ ุชูุนูู/ุงูุชูุงุก ุงูุงุดุชุฑุงูุงุช

---

**ุขุฎุฑ ุชุญุฏูุซ**: ููุงูุฑ 2026
